server {
    listen 80;
    server_name localhost;

    # Page de validation simple
    location /validate {
        add_header Content-Type text/html;
        return 200 '<html><head><title>Validation Magic Link</title></head><body><h1>Validation en cours...</h1><p>Token: $arg_token</p><p>User: $arg_user</p><p>Module: $arg_module</p><script>setTimeout(function(){window.location.href="http://metube:8081";},3000);</script></body></html>';
    }

    # Redirection vers validation si token pr√©sent
    location / {
        if ($args ~ "token=") {
            return 302 /validate$is_args$args;
        }
        return 302 http://metube:8081$request_uri;
    }
} 